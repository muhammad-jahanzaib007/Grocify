{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Grocify{% endblock %}</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
  <link rel="stylesheet" href="{% static 'css/pos.css' %}" />
  {% block extra_css %}{% endblock %}

  <link rel="stylesheet" href="{% static 'css/layout.css' %}" />
</head>

<body>
  <nav class="sidebar">
    <a href="{% url 'sales:index' %}" title="Sales">🛒</a>
    <a href="{% url 'purchases:index' %}" title="Purchases">🛍️</a>
    <a href="{% url 'inventory:stock_dashboard' %}" title="Inventory">📦</a>
    <a href="{% url 'customers:index' %}" title="Customers">👥</a>
    <a href="{% url 'loyalty:index' %}" title="Loyalty">⭐</a>
    <a href="{% url 'expenses:index' %}" title="Expenses">💸</a>
    <a href="{% url 'reports:index' %}" title="Analytics">📈</a>
    <a href="{% url 'sales:chain_dashboard' %}" title="Chain View">🌐</a>
  </nav>

  <header class="header-bar">
    <button class="btn btn-sm btn-light me-3 d-md-none" id="sidebarToggle">☰</button>
    <div>{% block header %}Welcome to Grocify{% endblock %}</div>
    <div class="receipt-id" id="receipt-id"></div>


    <div class="d-flex align-items-center ms-auto">
      <label for="location-switcher" class="text-white mb-0 me-2">Store:</label>
      <select id="location-switcher" class="form-select form-select-sm w-auto">
        <option value="all" {% if selected_location_id == "all" %}selected{% endif %}>
          All Stores
        </option>
        {% for loc in available_locations %}
          <option value="{{ loc.id }}"
            {% if selected_location_id == loc.id|stringformat:"s" %}selected{% endif %}>
            {{ loc.name }}
          </option>
        {% endfor %}
      </select>
      <button class="btn btn-sm btn-light ms-3" id="themeToggle">🌙</button>
    </div>
  </header>

  <main class="main-content">
    {% block breadcrumbs %}{% endblock %}
    {% block page_title %}<h1>{{ page_title }}</h1>{% endblock %}
    {% if messages %}
      <div class="alert-container">
        {% for msg in messages %}
          <div class="alert alert-{{ msg.tags }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
    {% block content %}{% endblock %}
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  <script>
    document.getElementById('location-switcher')?.addEventListener('change', function() {
      fetch("{% url 'sales:set_location' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ location_id: this.value })
      })
      .then(() => window.location.reload())
      .catch(console.error);
    });
  </script>
  <script>
    document.getElementById('sidebarToggle')?.addEventListener('click', function() {
      document.querySelector('.sidebar')?.classList.toggle('collapsed');
    });
  </script>
  <script>
    (function() {
      const toggle = document.getElementById('themeToggle');
      const root = document.documentElement;
      const current = localStorage.getItem('theme');
      if (current === 'dark') root.classList.add('dark-mode');
      if (toggle) {
        toggle.textContent = root.classList.contains('dark-mode') ? '☀️' : '🌙';
        toggle.addEventListener('click', function() {
          if (root.classList.contains('dark-mode')) {
            root.classList.remove('dark-mode');
            localStorage.setItem('theme','light');
            this.textContent = '🌙';
          } else {
            root.classList.add('dark-mode');
            localStorage.setItem('theme','dark');
            this.textContent = '☀️';
          }
        });
      }
    })();
  </script>

  {% block extra_js %}{% endblock %}
  <footer class="footer text-center py-3">
    {% block footer %}© {{ now.year }} Grocify{% endblock %}
  </footer>
</body>
</html>